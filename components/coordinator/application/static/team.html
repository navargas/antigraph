<!DOCTYPE html>

<title>Cumulus Repo</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,200,300'
  rel='stylesheet' type='text/css'>
<link rel='stylesheet' href='/css/style.css'>
<div id="content">
<!-- content -->

<h2>Cumulus Repo V2 Beta</h2>
<hr>
<p v-if="errorMsg" v-cloak class="errormessage">{{errorMsg}}</p>
<h1>Assets</h1>
<p v-if="!assets">None Found</p>
<p v-if="assets == 'init'">Loading...</p>
<div v-else v-for="assetGroup in assets.assets">
  <h3>{{ $key }}</h3>
  <table class="table table-bordered">
    <tbody>
      <tr v-for="asset in assetGroup"
          v-on:click="showVersions($parent.$key, $key)">
        <td>
          {{ $key }}
          <table class="table table-bordered versionTable"
              v-if="activeGroup == $parent.$key && activeAsset == $key">
            <thead>
              <tr>
                <th>Version</th>
                <th v-for="version in assets.legend">{{ version }}</th>
              </tr>
            </thead>
            <tbody v-on:click.stop.prevent="">
              <tr v-for="versionList in asset" class="nohl">
                <td>{{ $key }}</td>
                <td v-for="version in versionList">
                  <p v-if="offline($index)" class="redtext">check connection</p>
                  <div v-else>
                    <span v-if="version" class="glyphicon glyphicon-ok"></span>
                    <span v-if="version" class="glyphicon glyphicon-trash"
                          v-on:click="transfer($parent.$key, $index, true)"></span>
                    <a v-else v-on:click="transfer($parent.$key, $index)">transfer</a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<h1 v-if="allTransfers">
  All Transfers (<a v-on:click="toggleAllTransfers()">show recent</a>)
</h1>
<h1 v-else>
  Recent Transfers (<a v-on:click="toggleAllTransfers()">show all</a>)
</h1>
<table v-if="transfers && transfers.length>0" class="table table-bordered ">
  <thead>
    <tr>
      <th>Service</th>
      <th>Asset</th>
      <th>Source</th>
      <th>Destination</th>
      <th>Started By</th>
      <th>More</th>
    </tr>
  </thead>
  <tbody>
    <tr v-for="t in transfers"
        v-bind:class="{ 'greenBg': t.finished, 'redBg': t.failed}">
      <td>{{ t.service }}</td>
      <td>{{ t.asset }} ({{ t.version }})</td>
      <td>{{ t.source }}</td>
      <td>{{ t.target }}</td>
      <td>{{ t.creator }}</td>
      <td>
        <a target="_blank" href="/transfers/{{ t._id }}?format=html">info</a>
        <a v-if="!allTransfers" v-on:click="hideTransfer(t._id)">hide</a>
      </td>
    </tr>
  </tbody>
</table>
<p v-else>None</p>
<h1>Currently Unreachable</h1>
<table v-if="assets.offline && assets.offline.length > 0" class="table">
  <thead>
    <tr><th>Geography</th><th>Service</th><th>Reason</th></tr>
  </thead>
  <tbody>
    <tr v-for="geo in assets.offline">
      <td>{{ geo[0] }}</td>
      <td>{{ geo[1] }}</td>
      <td>{{ geo[2] }}</td>
    </tr>
  </tbody>
</table>
<p v-else>None</p>
<h1>Team Members</h1>
<p v-if="members.length == 0">None Found</p>
<table class="table table-bordered">
  <tbody>
    <tr v-for="member in members">
      <td class="nohl noclick">
        {{member}}
        <span class="glyphicon glyphicon-trash pullright click"
            v-on:click="removeMember(member)"></span>
      </td>
    </tr>
    <tr>
      <td class="dim" v-on:click.stop.prevent="toggleEmailField()">
        Add New Member
        <form class="loginform nomargin" action="/members" 
              method="POST" v-if="showEmailForm" v-on:click.stop="">
          <input type="text" placeholder="email address" name="email" />
          <button>Submit</button>
        </form>
      </td>
    </tr>
  </tbody>
</table>

<a href="/signout" class="hrefaction">sign out</a>
<a v-on:click="deleteteam()" class="hrefaction">delete team</a>

<!-- end content -->
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.25/vue.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.9.3/vue-resource.min.js"></script>
<script src="/js/common.js"></script>
<script src="/js/team.js"></script>
